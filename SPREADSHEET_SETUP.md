# スプレッドシート送信機能のセットアップ

このMBTI診断アプリの結果をGoogle Sheetsに自動送信する機能を設定する手順です。

## 1. Google Sheets APIの有効化

### 1.1 Google Cloud Consoleでプロジェクトを作成
1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. 新しいプロジェクトを作成するか、既存のプロジェクトを選択
3. プロジェクト名を記録しておく

### 1.2 Google Sheets APIを有効化
1. 左側のメニューから「APIとサービス」→「ライブラリ」を選択
2. 検索バーで「Google Sheets API」を検索
3. Google Sheets APIを選択して「有効にする」をクリック

### 1.3 APIキーを作成
1. 左側のメニューから「APIとサービス」→「認証情報」を選択
2. 「認証情報を作成」→「APIキー」をクリック
3. 作成されたAPIキーをコピーして安全な場所に保存
4. （推奨）APIキーの制限を設定：
   - 「アプリケーションの制限」で「HTTPリファラー」を選択
   - ドメインを追加（例：`localhost:3000/*`、本番環境のドメイン）

## 2. Google Sheetsの準備

### 2.1 スプレッドシートを作成
1. [Google Sheets](https://sheets.google.com/)で新しいスプレッドシートを作成
2. スプレッドシートのURLからIDを取得：
   ```
   https://docs.google.com/spreadsheets/d/【ここがスプレッドシートID】/edit
   ```

### 2.2 スプレッドシートの共有設定
1. スプレッドシートの右上の「共有」ボタンをクリック
2. 「リンクを知っている全員」に変更
3. 「閲覧者」に設定
4. 「完了」をクリック

### 2.3 ヘッダー行を追加
スプレッドシートの最初の行に以下のヘッダーを追加：

| タイムスタンプ | ID | 氏名 | チーム | リーダー% | プレイヤー% | ペルソナA | ペルソナB | ペルソナC | ペルソナD | ペルソナE | ペルソナF | 完了日時 |
|---------------|----|----|----|----|----|----|----|----|----|----|----|----|

## 3. 環境変数の設定

### 3.1 .envファイルを作成
プロジェクトのルートディレクトリに`.env`ファイルを作成：

```env
# Google Sheets API設定
REACT_APP_SPREADSHEET_ID=your_spreadsheet_id_here
REACT_APP_GOOGLE_API_KEY=your_google_api_key_here
```

### 3.2 値を設定
- `REACT_APP_SPREADSHEET_ID`: 手順2.1で取得したスプレッドシートID
- `REACT_APP_GOOGLE_API_KEY`: 手順1.3で作成したAPIキー

## 4. 動作確認

### 4.1 アプリケーションを起動
```bash
npm run dev
```

### 4.2 設定状況の確認
1. 診断を完了して結果画面に移動
2. 「設定状況を表示」ボタンをクリック
3. すべての項目が「設定済み」になっていることを確認

### 4.3 テスト送信
1. 「結果を保存」ボタンをクリック
2. 成功メッセージが表示されることを確認
3. Google Sheetsに新しい行が追加されることを確認

## 5. トラブルシューティング

### 5.1 よくあるエラー

**「スプレッドシートIDまたはAPIキーが設定されていません」**
- `.env`ファイルが正しく作成されているか確認
- 環境変数名が`REACT_APP_`で始まっているか確認
- アプリケーションを再起動

**「HTTP error! status: 403」**
- APIキーが正しく設定されているか確認
- Google Sheets APIが有効化されているか確認
- スプレッドシートの共有設定を確認

**「HTTP error! status: 404」**
- スプレッドシートIDが正しいか確認
- スプレッドシートが存在し、アクセス可能か確認

### 5.2 セキュリティのベストプラクティス

1. **APIキーの制限**: 本番環境では、APIキーにドメイン制限を設定
2. **環境変数の管理**: `.env`ファイルをGitにコミットしない
3. **スプレッドシートの権限**: 必要最小限の権限で共有設定

## 6. 本番環境での設定

本番環境にデプロイする際は、ホスティングサービスの環境変数設定機能を使用して、APIキーとスプレッドシートIDを設定してください。

### 6.1 Vercelの場合
1. プロジェクト設定→「Environment Variables」
2. 環境変数を追加：
   - `REACT_APP_SPREADSHEET_ID`
   - `REACT_APP_GOOGLE_API_KEY`

### 6.2 Netlifyの場合
1. サイト設定→「Environment variables」
2. 環境変数を追加

### 6.3 その他のホスティングサービス
各サービスの環境変数設定機能を使用して同様に設定してください。
